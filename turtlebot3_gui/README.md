# TurtleBot3 GUI

Графический интерфейс для управления TurtleBot3 с использованием PyQt5.

## Функциональность

- Управление движением робота с помощью кнопок (вперед, назад, влево, вправо, стоп)
- Управление с помощью клавиатуры (W/A/S/D или стрелки)
- Точное управление скоростью с помощью слайдеров
- Отображение данных с датчиков:
  - Состояние батареи (напряжение и процент заряда)
  - Позиция и ориентация (одометрия)
  - Расчетная позиция на основе данных энкодеров
  - Визуализация данных с 2D-лидара в реальном времени
  - Показания энкодеров колес
  - Текущая скорость робота
- Работа с двумя камерами:
  - Отображение изображений с передней и верхней камер в реальном времени
  - Обработка изображений с помощью OpenCV (детекция краев)
  - Публикация обработанных изображений в ROS

## Установка зависимостей

```bash
sudo apt install python3-pyqt5
pip3 install rospkg
```

Для работы с камерами и обработки изображений дополнительно установите:

```bash
sudo apt install ros-noetic-image-transport ros-noetic-cv-bridge ros-noetic-vision-opencv python3-opencv libopencv-dev ros-noetic-image-proc
```

## Запуск

### Вариант 1: Комплексный запуск (рекомендуется)

Этот вариант запускает и симуляцию, и GUI приложение, включая узел для публикации данных с энкодеров:

```bash
export TURTLEBOT3_MODEL=burger
roslaunch turtlebot3_gui turtlebot3_complete.launch
```

### Вариант 2: Запуск симуляции с данными сенсоров

```bash
export TURTLEBOT3_MODEL=burger
roslaunch turtlebot3_gui turtlebot3_with_sensors.launch
```

Затем в другом терминале:
```bash
roslaunch turtlebot3_gui turtlebot_gui.launch
```

### Вариант 3: Запуск с двумя камерами (требует Waffle Pi)

Этот вариант запускает симуляцию с моделью Waffle Pi с двумя камерами и обработкой изображений:

```bash
export TURTLEBOT3_MODEL=waffle_pi
roslaunch turtlebot3_gui turtlebot3_dual_cam.launch
```

### Вариант 4: Прямой запуск скрипта

```bash
cd /home/vanya890/catkin_ws/src/turtlebot3_gui/src
python3 turtlebot_gui.py
```

## Использование

1. Запустите приложение одним из способов выше

2. Используйте кнопки управления или клавиатуру для перемещения робота:
   - Кнопки: Forward, Backward, Left, Right, STOP
   - Клавиатура: W/↑ (вперед), S/↓ (назад), A/← (влево), D/→ (вправо), Пробел (стоп)
   - Слайдеры: для точной регулировки линейной и угловой скорости

3. Наблюдайте за данными с датчиков:
   - Battery: состояние батареи
   - Position: позиция из стандартной одометрии ROS
   - Encoder Odometry: позиция, рассчитанная на основе данных энкодеров
   - Laser: данные с лазерного сканера
   - Encoders: показания энкодеров колес
   - Speed: текущая скорость робота
   - Cameras: изображения с передней и верхней камер (если запущен с камерами)

## Работа с камерами и обработкой изображений

При запуске с поддержкой камер (Вариант 3), приложение автоматически:
1. Подписывается на топики с изображениями камер: `/front_camera/image_raw` и `/top_camera/image_raw`
2. Обрабатывает изображения с помощью OpenCV:
   - Применяет детектор краев Canny
   - Создает комбинированное изображение (оригинал + обработанное)
3. Публикует обработанные изображения в топики: `/front_camera/processed` и `/top_camera/processed`
4. Отображает изображения в реальном времени в интерфейсе приложения

### Архитектура обработки изображений

Для обработки изображений используется модульный подход:
- `camera_processor.py` - универсальный узел для обработки изображений с одной камеры
- Для каждой камеры запускается отдельный экземпляр этого узла с соответствующими параметрами
- Это позволяет гибко настраивать обработку для каждой камеры независимо

### Расположение камер

Камеры на роботе расположены следующим образом:
- Передняя камера: смещена вперед и немного вверх, чтобы не мешать движению
- Верхняя камера: расположена на высоте 12 см с небольшим наклоном для обзора
- Размеры камер уменьшены и сделаны полупрозрачными для минимизации визуального вмешательства

### Просмотр обработанных изображений

Для просмотра обработанных изображений в отдельном окне:

```bash
# Для передней камеры
rosrun image_view image_view image:=/front_camera/processed

# Для верхней камеры
rosrun image_view image_view image:=/top_camera/processed
```

### Настройка параметров обработки

Параметры обработки изображений можно настроить при запуске:

```bash
roslaunch turtlebot3_gui turtlebot3_dual_cam.launch canny_low:=30 canny_high:=100
```

Доступные параметры:
- `canny_low`: нижний порог детектора Canny (по умолчанию: 50)
- `canny_high`: верхний порог детектора Canny (по умолчанию: 150)
